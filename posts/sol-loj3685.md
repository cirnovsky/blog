---
date: '2023-10-14'
title: 'Solution -「JOISC 2022」刑務所'
category: 'Notes'
---

## Desc.

&emsp;&emsp;有无根树 $T = (V, E)$, 有 $m$ 个囚犯, 初始分别位于 $s_i$ 节点上. 每一时刻你可以将某个囚犯沿着无向边移动到相邻的节点, 判断是否存在一个方案, 使得所有囚犯分别**沿着最短路径**被移动到 $t_i$ 节点上, 并且不会出现同一时刻有两个或多个囚犯在同一节点上的情况. 多测.

&emsp;&emsp;$T \leqslant 10^3, n \leqslant 1.2 \times 10^5, 2 \leqslant m < n$.

## Sol.

&emsp;&emsp;[Link.](https://loj.ac/p/3685)

&emsp;&emsp;有一条性质:

- 同一时间图上不会有两个移动中的囚犯.

&emsp;&emsp;证明很简单, 钦定两个囚犯, 并讨论两条路径的相对关系即可.

&emsp;&emsp;有另外两条比较好看出来, 但应该不太好证的性质:

- 若囚犯 $j$ 的**起点** $s_j$ 位于另外某个囚犯 $i$ 的路径 $(s_j, t_j)$ 上, 那么 $i$ 一定**先于** $j$ 出发;
- 若囚犯 $j$ 的**终点** $s_j$ 位于另外某个囚犯 $i$ 的路径 $(s_j, t_j)$ 上, 那么 $i$ 一定**晚于** $j$ 出发;

&emsp;&emsp;~~意会一下吧.~~

&emsp;&emsp;根据上述的先后关系, 可以建出关于囚犯的有向图, 若该图存在拓扑序 (即为 DAG), 那么有解, 否则无解. 问题是如何优化连边. 将原树复制为两棵, 分别称为 $S$, $T$, 记原树节点 $i$ 在两棵新树上的对应节点编号为 $S_i$ 和 $T_i$. 将每个囚犯抽象成一个点, 编号记为 $p_i$, 我们来看看如何改写原题的信息. 连边 $\lang p_i, S_{s_i}\rang, \lang T_{t_i}, p_i \rang$, $\lang v \in (S_{s_i}, S_{t_i}) \setminus \{S_{s_i}\}, p_i \rang$, $\lang p_i, v \in (T_{s_i}, T_{t_i}) \setminus \{T_{t_i}\}\rang$.

&emsp;&emsp;我们来检验一下这样建图的可行性, 若 $s_i$ 在 $(s_j, t_j)$ 上, 那么存在路径 $p_i \rightarrowtail S_{s_i} \rightarrowtail p_j$, 反之亦然, 则先后关系得到了刻画. 再来考察正确性, 发现我们只是把直接连接 $p_i$ 和 $p_j$ 的边通过拆分 $(s_j, t_j)$ 的方式加「长」了, 因此并不会影响环的存在性.

&emsp;&emsp;那么使用重链剖分, 然后线段树优化建图即可.