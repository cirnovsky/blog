<!DOCTYPE html>
    <html lang="zh-cmn-Hans">
        <head>
            <meta charset="UTF-8" />
            <title>Solution -ã€ŒCSP-S 2020ã€å‡½æ•°è°ƒç”¨ | cirnovsky</title>

            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css" integrity="sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP" crossorigin="anonymous">

            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js" integrity="sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6" crossorigin="anonymous"></script>

            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous"
                onload="renderMathInElement(document.body);"></script>
            <script src="/src/js/jquery.min.js"></script>
            <link rel="stylesheet" href="/src/styles/prism.css" >
            <link rel="stylesheet" href="/src/styles/fonts.css" >
            <link rel="stylesheet" href="/src/styles/style.css" >
            <script>
                document.addEventListener("DOMContentLoaded", function() {
                    $("#giscus").load("/src/html/giscus.html")
                    $("#header").load("/src/html/header.html")
                    renderMathInElement(document.body, {
                        delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "$", right: "$", display: false}
                        ],
                        throwOnError: false,
                        errorColor: "#cc0000"
                    });
                })
            </script>
        </head>
        <body>
            <script src="/src/js/prism.js"></script>
            <div class="content">
                <div id="header"></div>
                <h2>Description</h2>  
<p>å¤§å®¶åº”è¯¥éƒ½è¯»è¿‡é¢˜ã€‚</p>  
<h2>Solution</h2>  
<p>èµ›åå˜æ‘©æ‰˜ğŸ˜ƒã€‚</p>  
<p>æˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªæ“ä½œ $3$ è¿è¾¹å»ºå›¾ï¼Œç„¶åå¯ä»¥çŸ¥é“åªæ˜¯ä¸€ä¸ª $\texttt{DAG}$ã€‚</p>  
<p>è€ƒè™‘æ“ä½œ $2$ï¼Œæˆ‘ä»¬åªéœ€è¦æœ€åè®¡ç®—å³å¯ã€‚</p>  
<p>ç°åœ¨æ¥çœ‹åŠ æ³•æ“ä½œã€‚æˆ‘ä»¬è®¾æˆ‘ä»¬å½“å‰çš„æ“ä½œä¸º $a_{p}\leftarrow a_{p}+v$ï¼Œåé¢ä¸€å…±æœ‰ $k$ ä¸ªä¹˜æ³•æ“ä½œï¼Œæˆ‘ä»¬è®¾ä¸ºåˆ†åˆ«è®©åºåˆ—æ•´ä½“ä¹˜ä¸Š $b_{1,2,\cdots,k}$ã€‚é‚£ä¹ˆ $a_{p}\leftarrow a_{p}+v$ ä¸€å…±ä¼šå¯¹æœ€åçš„ $a_{p}$ äº§ç”Ÿ $v\times\prod_{i=1}^{k}b_{i}$ çš„è´¡çŒ®ã€‚</p>  
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œç¦»çº¿ä¸‹æ¥ï¼Œå€’ç€æ¥å¤„ç†ã€‚</p>  
<p>é‚£ä¹ˆæœ€åæ¥è€ƒè™‘æ“ä½œ $3$ï¼Œæˆ‘ä»¬æ¥çœ‹æ“ä½œ $3$ è¿å‡ºçš„å›¾ã€‚</p>  
<p>å¯¹äºå›¾ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªå€¼ï¼Œè¡¨ç¤ºæ‰§è¡Œåä¼šå¸¦æ¥çš„ç³»æ•°ã€‚</p>  
<p>é‚£ä¹ˆå’Œæ“ä½œ $1$ ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯¹æ•´å¼ å›¾è¿›è¡Œæ‹“æ‰‘ï¼Œç„¶åå€’ç€å¤„ç†ï¼Œå¤„ç†å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„æ“ä½œçš„åŠ æ³•è®¡ç®—äº†å¤šå°‘æ¬¡ï¼Œç„¶åä¼ æ’­ï¼ˆæŒ‡æ‰€æœ‰ç›¸é‚»èŠ‚ç‚¹ï¼‰åˆ°åŠ æ³•æ“ä½œçš„èŠ‚ç‚¹ã€‚</p>  
<p>æœ€åå¤„ç†åŸåºåˆ—å³å¯ã€‚</p>  
<p>ï¼ˆä»£ç ä» $\texttt{Vim}$ é‡Œé¢å¤åˆ¶å‡ºæ¥å¯èƒ½ç¼©è¿›æœ‰é—®é¢˜ï¼‰</p>  


<pre><code class="language-cpp">#include &lt;queue&gt;
#include &lt;cstdio&gt;
#define mod ( 998244353 )

using namespace std;
typedef long long LL;

const int MAXN = 1e6 + 5;

template&lt;typename _T&gt;
void read( _T &amp;x ){
    x = 0; char c = getchar(); _T f = 1;
    while( c &lt; '0' || c &gt; '9' ){ if( c == '-' ) f = -1; c = getchar(); }
    while( c &gt;= '0' &amp;&amp; c &lt;= '9' ){ x = ( x &lt;&lt; 3 ) + ( x &lt;&lt; 1 ) + ( c &amp; 15 ); c = getchar(); }
    x *= f;
}

template&lt;typename _T&gt;
void write( _T x ){
    if( x &lt; 0 ){ putchar( '-' ); x = -x; }
    if( x &gt; 9 ) write( x / 10 );
    putchar( x % 10 + '0' );
}

struct starS{
    int to, nxt;
    starS( int T = 0, int N = 0 ){ to = T; nxt = N; }
} as[MAXN * 2];

struct operateS{
    int Tp, pos;
    LL add, mul, sum;
    operateS( int T = 0, int P = 0, LL A = 0, LL M = 0, LL S = 0 ){ Tp = T; pos = P; add = A; mul = M; sum = S; }
} opS[MAXN];

int N, M, Q;
int totE, totT;
int A[MAXN], topS[MAXN], degS[MAXN], firS[MAXN], queS[MAXN];

void pushEdge( int u, int v ){ as[++ totE] = starS( v, firS[u] ); firS[u] = totE; }

void TopSort( ){
    queue&lt;int&gt; align;
    for( int i = 1; i &lt;= M; ++ i ){
        if( ! degS[i] ) align.push( i );
    }
    while( ! align.empty( ) ){
        int u = align.front( ); align.pop( );
        topS[++ totT] = u;
        for( int i = firS[u]; i; i = as[i].nxt ){
            int v = as[i].to; degS[v] --;
            if( ! degS[v] ) align.push( v );
        }
    }
}

int main( ){
    read( N );
    for( int i = 1; i &lt;= N; ++ i )  read( A[i] );
    read( M );
    for( int i = 1; i &lt;= M; ++ i ){
        read( opS[i].Tp );
        if( opS[i].Tp == 1 ){
            read( opS[i].pos ); read( opS[i].add );
            opS[i].mul = 1;
        }
        else if( opS[i].Tp == 2 ) {
            read( opS[i].mul );
            opS[i].add = opS[i].mul;
        }
        else{
            read( opS[i].pos );
            opS[i].mul = 1;
            for( int j = 1, to; j &lt;= opS[i].pos; ++ j ){ read( to ); pushEdge( i, to ); degS[to] ++; }
        }
    }
    TopSort( );
    for( int i = M; i; -- i ){
        int u = topS[i];
        for( int j = firS[u]; j; j = as[j].nxt ){
            int v = as[j].to;
            opS[u].mul = ( LL )opS[u].mul * opS[v].mul % mod;
        }
    }
    read( Q ); int now = 1;
    for( int i = 1; i &lt;= Q; ++ i )  read( queS[i] );
    for( int i = Q; i; -- i ){ opS[queS[i]].sum = ( ( LL )opS[queS[i]].sum + now ) % mod; now = ( LL )now * opS[queS[i]].mul % mod; }
    for( int i = 1; i &lt;= M; ++ i ){
        int u = topS[i], now = 1;
        for( int j = firS[u]; j; j = as[j].nxt ){
            int v = as[j].to;
            opS[v].sum = ( ( LL )opS[u].sum * now % mod + opS[v].sum ) % mod;
            now = ( LL )now * opS[v].mul % mod;
        }
    }
    for( int i = 1; i &lt;= N; ++ i )  A[i] = ( LL )A[i] * now % mod;
        for( int i = 1; i &lt;= M; ++ i ){
        if( opS[i].Tp == 1 )    A[opS[i].pos] = ( A[opS[i].pos] + ( LL )opS[i].add * opS[i].sum % mod ) % mod;
    }
    for( int i = 1; i &lt;= N; ++ i )  write( A[i] ), putchar( ' ' );
    return 0;
}
</code></pre>
                <script src="https://giscus.app/client.js" data-repo="cirnovsky/blog-comments" data-repo-id="R_kgDOKmz0Wg" data-category="General" data-category-id="DIC_kwDOKmz0Ws4Caiud" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="gruvbox" data-lang="en" crossorigin="anonymous" async></script>
            </div>
        </body>
    </html>
